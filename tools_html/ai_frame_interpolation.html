<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI视频补帧与高清放大</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/ai_frame_interpolation.css">
</head>

<body>
    <div id="main_bg"></div>
    <div class="left_menu">
        <ul class="menu_root">
            <li class="left_item">
                <div class="left_icon" id="left_icon1"></div>
                <div class="item_context">AI工具箱</div>
                <ul class="sub_menu">
                    <li><a href="chatgpt.html">ChatGPT</a></li>
                    <li><a href="ai_upscale.html">AI高清放大</a></li>
                    <li><a href="ai_frame_interpolation.html">AI插帧/分辨率</a></li>
                    <li><a href="ai_draw.html">AI绘画</a></li>
                </ul>
            </li>
            <li class="left_item">
                <div class="left_icon" id="left_icon1"></div>
                <div class="item_context">3D工具/图片处理</div>
                <ul class="sub_menu">
                    <li><a href="compress_image.html">图片压缩转换</a></li>
                    <li><a href="3d_city.html">3D城市地形筑下载</a></li>
                    <li><a href="combine_rgba.html">贴图通道合成</a></li>
                    <li><a href="hdr_editor.html">HDR编辑器</a></li>
                    <li><a href="ps_online.html">在线PS</a></li>
                    <li><a href="pbr_texture_generator.html">PBR贴图生成器</a></li>
                    <li><a href="model_previewer.html">模型预览器</a></li>
                </ul>
            </li>
            <li class="left_item">
                <div class="left_icon" id="left_icon1"></div>
                <div class="item_context">视频处理</div>
                <ul class="sub_menu">
                    <li><a href="video_cut.html">视频剪辑</a></li>
                    <li><a href="video_format_cover.html">视频格式转换</a></li>
                </ul>
            </li>
            <li class="left_item">
                <div class="left_icon" id="left_icon1"></div>
                <div class="item_context">TA工具</div>
                <ul class="sub_menu">
                    <li><a href="shader_library.html">shader函数库</a></li>
                    <li><a href="ue_material_picture.html">UE材质库</a></li>
                    <li><a href="physics_light.html">物理光照计算器</a></li>
                    <li><a href="TA_wiki.html">TA知识库</a></li>
                </ul>
            </li>
            <li class="left_item">
                <div class="left_icon" id="left_icon1"></div>
                <div class="item_context">和我一起听</div>
                <ul class="sub_menu">
                    <li><a href="cloud_music.html">网易云音乐</a></li>
                </ul>
            </li>
            <li class="left_item">关于</li>
        </ul>
    </div>

    <div class="top_search">
        <input type="text" placeholder="搜索">
    </div>

    <div id="panel">
        <aside class="queue-sidebar">
            <div class="queue-title">视频队列</div>
            <div class="file-list" id="fileList"></div>
        </aside>

        <main class="main-content">
            <h1>AI视频补帧 + 高清放大（Topaz风格）</h1>
            <p class="subtitle">本地浏览器处理，不上传服务器。推荐短视频片段先测试参数。</p>

            <section class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <p>拖拽视频到此处或点击选择</p>
                        <p class="sub-text">支持 MP4 / MOV / WEBM / MKV（浏览器可解码）</p>
                    </div>
                </div>
                <input type="file" id="fileInput" multiple accept="video/*" hidden>
            </section>

            <section class="settings-panel">
                <div class="setting-group">
                    <label for="interpModelType">补帧模型</label>
                    <select id="interpModelType">
                        <option value="auto" selected>Auto (RIFE/FILM)</option>
                        <option value="rife">RIFE 签名</option>
                        <option value="film">FILM 签名</option>
                    </select>
                    <div style="display:flex;gap:8px;margin-top:6px;">
                        <button id="loadInterpModelBtn" class="btn-secondary" style="flex:1;">重新加载补帧模型</button>
                        <button id="uploadInterpModelBtn" class="btn-secondary" style="flex:1;">上传本地补帧模型</button>
                        <input id="interpModelFileInput" type="file" accept=".onnx" hidden>
                    </div>
                    <div class="hint" id="interpModelStatus">未加载补帧模型</div>
                </div>

                <div class="setting-group">
                    <label for="upscaleModelType">放大模型</label>
                    <select id="upscaleModelType">
                        <option value="auto" selected>Auto (ESRGAN类)</option>
                        <option value="esrgan">ESRGAN 签名</option>
                    </select>
                    <div style="display:flex;gap:8px;margin-top:6px;">
                        <button id="loadUpscaleModelBtn" class="btn-secondary" style="flex:1;">重新加载放大模型</button>
                        <button id="uploadUpscaleModelBtn" class="btn-secondary" style="flex:1;">上传本地放大模型</button>
                        <input id="upscaleModelFileInput" type="file" accept=".onnx" hidden>
                    </div>
                    <div class="hint" id="upscaleModelStatus">未加载放大模型</div>
                </div>

                <div class="setting-group">
                    <label for="modelPreset">AI增强档位</label>
                    <select id="modelPreset">
                        <option value="fast">Apollo Fast（预览速度）</option>
                        <option value="balanced">Chronos Balanced（推荐）</option>
                        <option value="detail" selected>Proteus Detail（细节优先）</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label for="frameMultiplier">目标帧率</label>
                    <select id="frameMultiplier">
                        <option value="30" selected>30 fps</option>
                        <option value="60">60 fps</option>
                        <option value="90">90 fps</option>
                        <option value="120">120 fps</option>
                    </select>
                    <div class="hint">选择目标输出帧率，系统会根据源帧率计算补帧数量</div>
                </div>

                <div class="setting-group">
                    <label for="sourceFps">源帧率估计</label>
                    <input id="sourceFps" type="number" min="8" max="120" step="1" value="30">
                    <div class="hint">用于补帧计算，不会修改源视频时长</div>
                </div>

                <div class="setting-group">
                    <label for="upscaleFactor">目标分辨率</label>
                    <select id="upscaleFactor">
                        <option value="keep">原始分辨率（保持）</option>
                        <option value="1k">1K（约1280宽）</option>
                        <option value="2k">2K（约2048宽）</option>
                        <option value="4k" selected>4K（约3840宽）</option>
                    </select>
                    <div class="hint">选择输出分辨率档位（按宽度近似），会按比例放大原视频</div>
                </div>

                <div class="setting-group slider-group">
                    <label for="denoiseStrength">去噪强度 <span id="denoiseValue">20</span></label>
                    <input id="denoiseStrength" type="range" min="0" max="100" step="1" value="20">
                </div>

                <div class="setting-group slider-group">
                    <label for="sharpenStrength">锐化强度 <span id="sharpenValue">35</span></label>
                    <input id="sharpenStrength" type="range" min="0" max="100" step="1" value="35">
                </div>

                <div class="setting-group slider-group">
                    <label for="detailStrength">细节恢复 <span id="detailValue">30</span></label>
                    <input id="detailStrength" type="range" min="0" max="100" step="1" value="30">
                </div>

                <div class="setting-group">
                    <label for="outputFormat">输出容器</label>
                    <select id="outputFormat">
                        <option value="mp4" selected>MP4 (WebCodecs)</option>
                        <option value="webm">WebM (兼容回退)</option>
                        <option value="auto">自动选择</option>
                    </select>
                    <div class="hint">MP4依赖浏览器支持 WebCodecs + H264/VP9</div>
                </div>

                <div class="setting-group">
                    <label for="debug3s">调试：3s 快速运行</label>
                    <input id="debug3s" type="checkbox">
                    <div class="hint">开启后仅处理视频前 3 秒，便于快速调试参数和流程</div>
                </div>
            </section>

            <section class="action-buttons">
                <button id="clearBtn" class="btn-secondary">清空队列</button>
                <button id="downloadAllBtn" class="btn-secondary" style="display:none;">下载全部</button>
                <button id="processBtn" class="btn-primary" disabled>开始处理</button>
            </section>

            <section class="progress-container" id="progressContainer" style="display:none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">等待处理</div>
            </section>

            <section class="preview-panel">
                <div class="preview-header">
                    <div class="preview-title-wrap">
                        <h2>结果对比</h2>
                        <span id="previewMetrics">原片: - | 输出: -</span>
                    </div>
                    <span id="previewFileName">未选择文件</span>
                </div>
                <div class="video-compare" id="compareBox">
                    <video id="previewBefore" muted playsinline controls></video>
                    <video id="previewAfter" muted playsinline controls></video>
                    <div class="compare-divider" id="compareDivider"></div>
                </div>
                <input type="range" id="compareSlider" min="0" max="100" value="50">
            </section>
        </main>
    </div>

    <script src="../js/menu.js"></script>
    <script src="https://fastly.jsdelivr.net/npm/onnxruntime-web@1.17.1/dist/ort.webgpu.min.js"></script>
    <script src="../third_part/mp4-muxer.umd.js"></script>
    <!-- Cache-busted script to force clients to fetch updated JS -->
    <script src="../js/ai_frame_interpolation.js?v=3"></script>
</body>

</html>
